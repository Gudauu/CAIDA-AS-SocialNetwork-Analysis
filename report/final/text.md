## 一 标题
## 二 摘要
## 三 引言
该论文旨在通过对网络的自治系统 (Autonomous System, 缩写 AS) 级别关系构成的图分析，深入探讨自治系统网络技术和经济方面的相关性。准确了解自治系统业务关系对于互联网的域间结构的技术和经济方面都具有弥足重要意义。首先，自治系统之间的关系决定了路由策略，这为互联网流量路径引入了一组非平凡的约束条件。这对网络的鲁棒性、流量工程、宏观拓扑测量策略以及其他研究和运营考虑都有影响。其次，对自治系统间关系的宏观分析不仅可以揭示当前互联网商业实现的经济基础，而且还为基于经济的互联网拓扑演化建模提供了一个坚实的验证框架。实际上，互联网自治系统级别的拓扑和其演化动态都是互联网参与者做出的商业决策的结果。因此，推断AS之间的关系是理解和建模驱动互联网拓扑及其层次结构演化的经济力量的有前途的工具。
由于自治系统研究对于互联网生态的重要性，不同学科，组织均对这一课题进行过研究。较早的研究如<Analysis of the Autonomous System Network Topology>，文章中研究者使用的是一个较为流行的数据集:NLANR组织收集和维护的BGP路由表信息。他们通过解析路由表得到自治系统数据，基于此剖析了1994至2000年自治系统的拓扑结构特点，收集得到了一系列符合幂定律(power-law)的统计学特征。较新的研究有<Research on Topology Evolution of Autonomous System Network>，基于与前述类似的数据处理方法，这篇文章覆盖了2000-2020年的自治系统网络分析结果，得到了网络发展演变逻辑方面的若干结论，并对于国家级别的拓扑逻辑进行了分析。除了宏观层面的网络分析外，亦有文章如<Evolution of the Internet AS-level topology: From nodes and edges to components>从底层案例出发，生动地阐述了自治系统偏低层构成部份的行为特征。
以上若干文章的数据初始形态均为原始BGP路由数据，研究者对其进行处理后方得到自治系统层面数据，因此带来因数据处理而生的不确定性，这对结果的验证，其他研究者对其实验的复现均带来了额外的难度。在本篇论文中，使用的数据集直接为处理后的自治系统关系数据，因而相较于前述研究去除了这份不确定性。此外，前述论文均主要针对自治系统的网络特性，即连通性特征进行研究，着眼于宏观的拓扑结构，或部件间的互连指标。而对于自治系统的贸易特征，亦或没有提及，亦或加以淡化。本篇论文则以自治系统的贸易关系为着眼点，从数据处理到模型建立，均致力于从利益、贸易角度探索规律，在需要时也兼顾部分网络特征研究。同时，由于本篇论文成文时世界各国已完整经历新型冠状病毒疫情对经济、政治等领域的影响，研究中也涉及疫情对于自治系统贸易演变的影响分析。
本篇论文主题部分将采用如下结构:
1. 对数据集的介绍（包括所述机构，收集方法，时间段，以及自治系统推演算法）
2. 实验环境（机器，编程语言，画图语言）
3. 数据总览
4. 宏观网络演变分析
5. 自治系统层级的实例分析
6. 以国家为单位的聚合分析
7. 新冠疫情的影响分析及启示

## 四 背景
互联网由成千上万个互联网服务提供商(ISP)组成。这些运营商拥有和控制自己名下的自治系统，构成BGP中的基础单位。ISP间存在沟通交流，以便协同和普遍地路由互联网流量，而这种沟通交流最终通常以商业协议的形式展现在网络中。这些商业协议的出发点可能来自利益链、政治因素等等，落实在协议内容中则成为网络中人为引入的路由规则。正因这类政策的存在，自治系统间的网络路由才变得复杂，不定，和难以预测。
研究自治系统间的关系，对BGP协议，对互联网的发展，都有重要意义。通过对它的研究，我们可以找到现有路由机制的弊端从而优化网络路径;我们可以通过评估自治系统关系对网络基础设施的影响，来构建更有扩展性的互联网增长模型架构;也可以通过它对现有同行和上游服务商的表现进行评估，从而帮助服务商进行选择。
然而，出于隐私，商业机密等等考虑，直接研究自治系统被证明是非常困难的，因为迄今为止并没有服务商或第三方机构提供公开透明的自治系统协议数据。这些数据只有参与协议运营商知晓。因此，在无法直接获得自治系统数据的情况下，研究者转而选择使用可以公开收集到的BGP路由数据，用算法处理后得到计算出的自治系统贸易数据。
关于这类推导算法的研究最早由L.Gao在<On Inferring Autonomous System Relationships in the Internet>中阐述。在她的研究中，将ISP间（也即自治系统间）的商业关系分为三类：顾客-提供商型c2p(customer-to-provider)，同行型p2p(peer-to-peer)和同辈型s2s(sibling-to-sibling)。这种分类的依据在于自治系统间需要通过购买或商业协定来借助其他自治系统进行网络包传输。在顾客-提供商型中，这种关系的箭头方向标志着资金流动的方向：处于低位的顾客自治系统向处于高位的提供商自治系统付费，以换取提供商自治系统使用其资源帮助自己传输数据包。同行型协议中的双方达成协议，互相帮助对方传输对方本身及其顾客的数据包，以节省服务购买的开销。同辈型关系中的自治系统往往隶属于同一管辖域（如同个ISP），这类关系通常象征着自治系统团体的合并、收购。Gao设计算法的根据思想在于，对于一条有效的自治系统贸易链条，每一跳中的中转节点（即帮助其他自治系统进行数据传输的自治系统）都应在本条链条中存在相邻节点对其服务付费。而若遵守这一思想，则所有合理的链条路径必然遵守如下模式：零到多个顾客-提供商型边，紧接着零到多个同行型边，紧接着零到多个提供商-顾客型边。同辈型边可以在任意位置出现，因为这种边相当于内部路径，不代表贸易关系。如果将顾客看作低位节点，而提供商看作高位节点，则这样的模式路径将是一条爬坡后下降的峰值曲线，爬升只有一次，一旦下降后不能再次爬升。而根据自治系统网络的经验规律，在这条峰值曲线顶端的节点，往往是本条链路中度数(degree)最大的节点。因此，对于一条BGP路由链路，我们就可以通过先剥取顶峰节点，来逐个推断出其余节点的贸易关系。
自gao的研究后，后续涌现出多位相似研究。Subramanian等人继承了上述有效路径判定方法，但将AS关系推断问题制定为组合优化问题：给定从一组BGP路径P导出的无向图G，为G中的每条边分配边类型（c2p或p2p），使P中有效路径的总数最大化。该问题被称为关系类型（ToR）问题，且后被Di Battista等人和Erlebach等人独立地证明为NP完全问题。在本篇论文中，使用的数据集使用的推演算法类似于<AS Relationships, Customer Cones, and Validation>中的研究，它亦是对Gao工作的继承，使用一组事先设定的条件进行边关系的推演。
每个自治系统有一个唯一的数字编号，称为自治系统编号(ASN)。自治系统编号 由 The Internet Assigned Numbers Authority (IANA)统一管理。当ISP申请新自治系统编号时，将经由IANA获批得到一个数字。值得注意的是，该数字编号存在被重复利用的可能性。若一个ISP决定抛弃自己旗下的自治系统，那么IANA将回收这一自治系统编号，并可能在新的ISP申请时重新发放这个数字。因此，当进行自治系统编号与自治系统信息匹配时，需要充分考虑编号替换的可能性。


## 五 实验
### 5.1 数据集
贡献本文所使用的数据的机构为Center for Applied Internet Data Analysis (CAIDA)。CAIDA成立于1997年，是加州大学圣地亚哥分校超级计算机中心所下属的计算机网络数据科研中心，主持分享许多与计算机网络协议有关的大数据集。这些数据集均为公开<>。其中，本篇论文所用数据集为"Inferred AS Relationships Dataset"<https://publicdata.caida.org/datasets/as-relationships/>，它是一个由BGP路由数据推理出的自治系统关系数据集，关于推理算法的介绍见"四 背景"部份。CAIDA所共享的数据自1998年开始，每月一份，最新的数据收集于2023年5月，即本文写成时。数据名开头为年份月份，结尾均为"01"，如"20230501"等。以下均用上述编号来表示对应的数据。每份数据文件格式一致，各行为以自治系统编号表示的顾客-提供商型边和同行型边，最小的有5772行（19980101），最大的有380544行（20230101）。本文使用的数据主要为2000至2023年每年1月的数据。
除了上述主要数据集外，匹配自治系统编号和自治系统信息的数据来自于<https://bgp.potaroo.net/cidr/autnums.html>，它将每个自治系统编号对应至当前所属ISP，国家（或地区）。本文所使用的匹配信息拉取于2023年2月28号。
如前所述，自治系统编号存在重复利用的可能性。匹配数据仅提供最新数据，而CAIDA的数据则截录了几十年来的历史数据。因此，我们目前将自治系统编号所匹配上的自治系统信息未必是正确的。为了避免受该问题影响，本文涉及自治系统国别和运营商信息的分析中使用的自治系统均只选择在研究期限内持续存在的编号。若某编号在每次数据中不存在，则将其排除不进行进一步分析。但在统计数据总量等与自治系统运营信息无关的研究时，编号仍然会被考虑。

### 5.2 实验环境
整个实验在两台机器上完成。主机器运行ArchLinux，副机运行Ubuntu，大部分计算量大的图分析程序在副机上运行。由于本实验中不涉及算法性能、速度评估等，因此对机器的运算资源不作描述。
实验所用程序主要使用Python语言，调用Python-Easygraph和Networkx图分析库进行图解析。数据解压处理设计少量bash脚本。绘图使用R语言。IDE环境为vscode。

### 5.3 数据总览
### 5.3.1 总量
从2000至2023年，逐年自治系统(AS)和自治系统协议(Autonomous System Relationship, ASR)的总数波动情况见图1。其中自治系统总量为数据文件中出现的不同自治系统编号个数，而自治系统协议总量即为数据文件的总有效行数。在图理论中，可将自治系统看作节点，将自治系统协议看作边。由于协议边分为两类：提供商-顾客型边(注意！文中数据处理后顾客与提供商关系展现为p2c，而非前面出现的c2p，其实只是方向调换，并无其他区别)和同行型边，在构图时作如下处理：对于提供商-顾客型边，画一条
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/basic/result/size_of_ASes_and_ASRs.png)
图中自治系统总量(AS count)似乎是一条线性增长线。若将2000年视作0，2023年视作23,则自治系统总量(y)与时间（x）的关系可被如下公式描绘:
y = 3056.05x + 4346.29
以上公式的R-square值为0.9944879055571465。
而另一方面，图中自治系统协议总量(ASR count)在2021年前则似乎符合指数增长。若使用同样的年份转换方法，并以指数函数去匹配数据，则自治系统协议总量(y)与时间（x）的关系可被如下公式描绘:
y = 28413.58*(0.15^x) - 4049.77。
以上公式的R-square值为0.86。注意上述公式计算时去除了2021-2023年的数据。图中绿色的"ASR Prediction"曲线即为根据上述公式拟合后得到的自治系统协议总量值。
2021至2023年，虽然自治系统总量的增长趋势似乎未受影响，自治系统协议总量则产生了较大的颠簸。不难联想这一波动的主要原因即是新冠疫情影响。对于疫情影响的分析见5.7章，此处不多赘述。
### 5.3.2 连通分量
在2000至2023年，除2005,2007,2008,2010,2011,2020外，其余年份的连通分量均为1个。而在上述非连通年份中，除2005年外，其余年份的连通分量均为2。这其中断裂的，不与主要连通分量相连接的，除却一些较小规模，可能为私人机构使用的小自治系统外（连通分量大小为2），另有两个较大规模的连通分量，分别为自治系统1和8所属的连通分量。自治系统1是Level 3 Communications, LLC (原名LVLT-1)机构下属的自治系统，是互联网中最老，知名度最高的自治系统之一，也曾作为主干网的成分，影响极大一部分网络。但在2003年后，其进出度（此处进出度即指与其有协议的自治系统个数）急剧下降，此后出现数次其所在连通分支不与主连通分支相连的情况。而自治系统8所属于美国莱斯大学(Rice University)，是该校校园网的主干节点，主要与其他学术研究机构相连，在2005与2007年也出现了断连的情况。
相比于主连通分量，这些断裂的小连通分量的规模几乎可以忽略。但它们的存在反映了在自治系统层面的网络，依然存在非主流使用的案例。
### 5.3.3 度分布
已有多项前人的研究指出，网络级别的图，其节点度数（各类型协议数）分布符合长尾效应。而在自治系统网络中，这一效应同样明显。图2、3分别是2000年和2023年1月的自治系统节点度数的CDF分布。图3中可以看出90%的自治系统度数小于20,而图1几乎所有节点度数均小于20。事实上，因为疫情影响，2023年超大型自治系统的规模已经小了许多，因此曲线的陡度才略小于图2。在这期间的20年间，图2所展现的才是常态。
![alt text](report/R/degree_distribution_cdf/result/degree_distribution_cdf_2000.png)
![alt text](report/R/degree_distribution_cdf/result/degree_distribution_cdf_2023.png)
我们也计算了每年的平均节点度数，它从1998年的4.90,一路升至2022年的16.74,在2023年首次相较有所下降（16.34）。这一度数的提升主要为超大型自治系统膨胀的结果。


### 5.4 宏观网络演变分析
对于贸易性质的不透明协议而言，其演变规律最能够彰显暗藏的规律。在这一章中，将探索整个自治系统节点、协议的增减规律。
### 5.4.1 节点
此处的节点即自治系统。自治系统总数的逐年增减变化图见图4。
![alt text](report/R/node_edge_fluc/result/across_years/AS_2000_2023.png)
图中，最上方的橙色色块为增值，中间的黄色色块为减值，下方的绿色色块为净增值。每个色块的具体数值显示在中央，色块长度与数值大小成比例。
对于净增值，也即每年净新增自治系统的数量，排除极端年份后稳定在区间[1500,3900]内，而网络的节点总数自2002年以达到了万级，因此其数值波动相较于总量并不明显。这一观察与5.3.1中自治系统的线性增长曲线是相符的。
相对稳定的净增值也意味着增值和减值并不稳定。图中可以看出橙色和黄色色块均有逐年增长的趋势。而鉴于二者的插值较为平均，我们可以推论增减值的总体增长幅度是相似的。这表明自治系统的增减并非全然是市场兴衰的指标，在网络贸易兴隆的年间，增减幅度都会相应上升。事实上，运营商选择撤去一个自治系统除了打算丢弃相关业务外，也完全可能是出于架构设计而进行的合并。这样能够更好地解释自治系统增减值之间的正相关性。



### 5.5 自治系统层级的实例分析
### 5.6 以国家为单位的聚合分析
### 5.7 新冠疫情的影响分析及启示
## 六 结论
## 七 参考

### 数据集
这篇论文所采用的数据集是