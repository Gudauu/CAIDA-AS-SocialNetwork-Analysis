## 一 标题
## 二 摘要
## 三 引言
该论文旨在通过对网络的自治系统 (Autonomous System, 缩写 AS) 级别关系构成的图分析，深入探讨自治系统网络技术和经济方面的相关性。准确了解自治系统业务关系对于互联网的域间结构的技术和经济方面都具有弥足重要意义。首先，自治系统之间的关系决定了路由策略，这为互联网流量路径引入了一组非平凡的约束条件。这对网络的鲁棒性、流量工程、宏观拓扑测量策略以及其他研究和运营考虑都有影响。其次，对自治系统间关系的宏观分析不仅可以揭示当前互联网商业实现的经济基础，而且还为基于经济的互联网拓扑演化建模提供了一个坚实的验证框架。实际上，互联网自治系统级别的拓扑和其演化动态都是互联网参与者做出的商业决策的结果。因此，推断AS之间的关系是理解和建模驱动互联网拓扑及其层次结构演化的经济力量的有前途的工具。
由于自治系统研究对于互联网生态的重要性，不同学科，组织均对这一课题进行过研究。较早的研究如<Analysis of the Autonomous System Network Topology>，文章中研究者使用的是一个较为流行的数据集:NLANR组织收集和维护的BGP路由表信息。他们通过解析路由表得到自治系统数据，基于此剖析了1994至2000年自治系统的拓扑结构特点，收集得到了一系列符合幂定律(power-law)的统计学特征。较新的研究有<Research on Topology Evolution of Autonomous System Network>，基于与前述类似的数据处理方法，这篇文章覆盖了2000-2020年的自治系统网络分析结果，得到了网络发展演变逻辑方面的若干结论，并对于国家级别的拓扑逻辑进行了分析。除了宏观层面的网络分析外，亦有文章如<Evolution of the Internet AS-level topology: From nodes and edges to components>从底层案例出发，生动地阐述了自治系统偏低层构成部份的行为特征。
以上若干文章的数据初始形态均为原始BGP路由数据，研究者对其进行处理后方得到自治系统层面数据，因此带来因数据处理而生的不确定性，这对结果的验证，其他研究者对其实验的复现均带来了额外的难度。在本篇论文中，使用的数据集直接为处理后的自治系统关系数据，因而相较于前述研究去除了这份不确定性。此外，前述论文均主要针对自治系统的网络特性，即连通性特征进行研究，着眼于宏观的拓扑结构，或部件间的互连指标。而对于自治系统的贸易特征，亦或没有提及，亦或加以淡化。本篇论文则以自治系统的贸易关系为着眼点，从数据处理到模型建立，均致力于从利益、贸易角度探索规律，在需要时也兼顾部分网络特征研究。同时，由于本篇论文成文时世界各国已完整经历新型冠状病毒疫情对经济、政治等领域的影响，研究中也涉及疫情对于自治系统贸易演变的影响分析。
本篇论文主题部分将采用如下结构:
1. 对数据集的介绍（包括所述机构，收集方法，时间段，以及自治系统推演算法）
2. 实验环境（机器，编程语言，画图语言）
3. 数据总览
4. 宏观网络演变分析
5. 自治系统层级的实例分析
6. 以国家为单位的聚合分析
7. 新冠疫情的影响分析及启示

## 四 背景
互联网由成千上万个互联网服务提供商(ISP)组成。这些运营商拥有和控制自己名下的自治系统，构成BGP中的基础单位。ISP间存在沟通交流，以便协同和普遍地路由互联网流量，而这种沟通交流最终通常以商业协议的形式展现在网络中。这些商业协议的出发点可能来自利益链、政治因素等等，落实在协议内容中则成为网络中人为引入的路由规则。正因这类政策的存在，自治系统间的网络路由才变得复杂，不定，和难以预测。
研究自治系统间的关系，对BGP协议，对互联网的发展，都有重要意义。通过对它的研究，我们可以找到现有路由机制的弊端从而优化网络路径;我们可以通过评估自治系统关系对网络基础设施的影响，来构建更有扩展性的互联网增长模型架构;也可以通过它对现有同行和上游服务商的表现进行评估，从而帮助服务商进行选择。
然而，出于隐私，商业机密等等考虑，直接研究自治系统被证明是非常困难的，因为迄今为止并没有服务商或第三方机构提供公开透明的自治系统协议数据。这些数据只有参与协议运营商知晓。因此，在无法直接获得自治系统数据的情况下，研究者转而选择使用可以公开收集到的BGP路由数据，用算法处理后得到计算出的自治系统贸易数据。
关于这类推导算法的研究最早由L.Gao在<On Inferring Autonomous System Relationships in the Internet>中阐述。在她的研究中，将ISP间（也即自治系统间）的商业关系分为三类：顾客-提供商型c2p(customer-to-provider)，同行型p2p(peer-to-peer)和同辈型s2s(sibling-to-sibling)。这种分类的依据在于自治系统间需要通过购买或商业协定来借助其他自治系统进行网络包传输。在顾客-提供商型中，这种关系的箭头方向标志着资金流动的方向：处于低位的顾客自治系统向处于高位的提供商自治系统付费，以换取提供商自治系统使用其资源帮助自己传输数据包。同行型协议中的双方达成协议，互相帮助对方传输对方本身及其顾客的数据包，以节省服务购买的开销。同辈型关系中的自治系统往往隶属于同一管辖域（如同个ISP），这类关系通常象征着自治系统团体的合并、收购。Gao设计算法的根据思想在于，对于一条有效的自治系统贸易链条，每一跳中的中转节点（即帮助其他自治系统进行数据传输的自治系统）都应在本条链条中存在相邻节点对其服务付费。而若遵守这一思想，则所有合理的链条路径必然遵守如下模式：零到多个顾客-提供商型边，紧接着零到多个同行型边，紧接着零到多个提供商-顾客型边。同辈型边可以在任意位置出现，因为这种边相当于内部路径，不代表贸易关系。如果将顾客看作低位节点，而提供商看作高位节点，则这样的模式路径将是一条爬坡后下降的峰值曲线，爬升只有一次，一旦下降后不能再次爬升。而根据自治系统网络的经验规律，在这条峰值曲线顶端的节点，往往是本条链路中度数(degree)最大的节点。因此，对于一条BGP路由链路，我们就可以通过先剥取顶峰节点，来逐个推断出其余节点的贸易关系。
自gao的研究后，后续涌现出多位相似研究。Subramanian等人继承了上述有效路径判定方法，但将AS关系推断问题制定为组合优化问题：给定从一组BGP路径P导出的无向图G，为G中的每条边分配边类型（c2p或p2p），使P中有效路径的总数最大化。该问题被称为关系类型（ToR）问题，且后被Di Battista等人和Erlebach等人独立地证明为NP完全问题。在本篇论文中，使用的数据集使用的推演算法类似于<AS Relationships, Customer Cones, and Validation>中的研究，它亦是对Gao工作的继承，使用一组事先设定的条件进行边关系的推演。
每个自治系统有一个唯一的数字编号，称为自治系统编号(ASN)。自治系统编号 由 The Internet Assigned Numbers Authority (IANA)统一管理。当ISP申请新自治系统编号时，将经由IANA获批得到一个数字。值得注意的是，该数字编号存在被重复利用的可能性。若一个ISP决定抛弃自己旗下的自治系统，那么IANA将回收这一自治系统编号，并可能在新的ISP申请时重新发放这个数字。因此，当进行自治系统编号与自治系统信息匹配时，需要充分考虑编号替换的可能性。


## 五 实验
### 5.1 数据集
贡献本文所使用的数据的机构为Center for Applied Internet Data Analysis (CAIDA)。CAIDA成立于1997年，是加州大学圣地亚哥分校超级计算机中心所下属的计算机网络数据科研中心，主持分享许多与计算机网络协议有关的大数据集。这些数据集均为公开<>。其中，本篇论文所用数据集为"Inferred AS Relationships Dataset"<https://publicdata.caida.org/datasets/as-relationships/>，它是一个由BGP路由数据推理出的自治系统关系数据集，关于推理算法的介绍见"四 背景"部份。CAIDA所共享的数据自1998年开始，每月一份，最新的数据收集于2023年5月，即本文写成时。数据名开头为年份月份，结尾均为"01"，如"20230501"等。以下均用上述编号来表示对应的数据。每份数据文件格式一致，各行为以自治系统编号表示的顾客-提供商型边和同行型边，最小的有5772行（19980101），最大的有380544行（20230101）。本文使用的数据主要为2000至2023年每年1月的数据。
除了上述主要数据集外，匹配自治系统编号和自治系统信息的数据来自于<https://bgp.potaroo.net/cidr/autnums.html>，它将每个自治系统编号对应至当前所属ISP，国家（或地区）。本文所使用的匹配信息拉取于2023年2月28号。
如前所述，自治系统编号存在重复利用的可能性。匹配数据仅提供最新数据，而CAIDA的数据则截录了几十年来的历史数据。因此，我们目前将自治系统编号所匹配上的自治系统信息未必是正确的。为了避免受该问题影响，本文涉及自治系统国别和运营商信息的分析中使用的自治系统均只选择在研究期限内持续存在的编号。若某编号在每次数据中不存在，则将其排除不进行进一步分析。但在统计数据总量等与自治系统运营信息无关的研究时，编号仍然会被考虑。

### 5.2 实验环境
整个实验在两台机器上完成。主机器运行Archlinux，副机运行Ubuntu，大部分计算量大的图分析程序在副机上运行。由于本实验中不涉及算法性能、速度评估等，因此对机器的运算资源不作描述。
实验所用程序主要使用Python语言，调用Python-Easygraph和Networkx图分析库进行图解析。数据解压处理设计少量bash脚本。绘图使用R语言。IDE环境为vscode。

### 5.3 数据总览
### 5.3.1 总量
从2000至2023年，逐年自治系统(AS)和自治系统协议(Autonomous System Relationship, ASR)的总数波动情况见图1。其中自治系统总量为数据文件中出现的不同自治系统编号个数，而自治系统协议总量即为数据文件的总有效行数。在图理论中，可将自治系统看作节点，将自治系统协议看作边。由于协议边分为两类：提供商-顾客型边(注意！文中数据处理后顾客与提供商关系展现为p2c，而非前面出现的c2p，其实只是方向调换，并无其他区别)和同行型边，在构图时作如下处理：对于提供商-顾客型边，画一条
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/basic/result/size_of_ASes_and_ASRs.png)
图中自治系统总量(AS count)似乎是一条线性增长线。若将2000年视作0，2023年视作23,则自治系统总量(y)与时间（x）的关系可被如下公式描绘:
y = 3056.05x + 4346.29
以上公式的R-square值为0.9944879055571465。
而另一方面，图中自治系统协议总量(ASR count)在2021年前则似乎符合指数增长。若使用同样的年份转换方法，并以指数函数去匹配数据，则自治系统协议总量(y)与时间（x）的关系可被如下公式描绘:
y = 28413.58*(0.15^x) - 4049.77。
以上公式的R-square值为0.86。注意上述公式计算时去除了2021-2023年的数据。图中绿色的"ASR Prediction"曲线即为根据上述公式拟合后得到的自治系统协议总量值。
2021至2023年，虽然自治系统总量的增长趋势似乎未受影响，自治系统协议总量则产生了较大的颠簸。不难联想这一波动的主要原因即是新冠疫情影响。对于疫情影响的分析见5.7章，此处不多赘述。
### 5.3.2 连通分量
在2000至2023年，除2005,2007,2008,2010,2011,2020外，其余年份的连通分量均为1个。而在上述非连通年份中，除2005年外，其余年份的连通分量均为2。这其中断裂的，不与主要连通分量相连接的，除却一些较小规模，可能为私人机构使用的小自治系统外（连通分量大小为2），另有两个较大规模的连通分量，分别为自治系统1和8所属的连通分量。自治系统1是Level 3 Communications, LLC (原名LVLT-1)机构下属的自治系统，是互联网中最老，知名度最高的自治系统之一，也曾作为主干网的成分，影响极大一部分网络。但在2003年后，其进出度（此处进出度即指与其有协议的自治系统个数）急剧下降，此后出现数次其所在连通分支不与主连通分支相连的情况。而自治系统8所属于美国莱斯大学(Rice University)，是该校校园网的主干节点，主要与其他学术研究机构相连，在2005与2007年也出现了断连的情况。
相比于主连通分量，这些断裂的小连通分量的规模几乎可以忽略。但它们的存在反映了在自治系统层面的网络，依然存在非主流使用的案例。
### 5.3.3 度分布
已有多项前人的研究指出，网络级别的图，其节点度数（各类型协议数）分布符合长尾效应。而在自治系统网络中，这一效应同样明显。图2、3分别是2000年和2023年1月的自治系统节点度数的CDF分布。图3中可以看出90%的自治系统度数小于20,而图1几乎所有节点度数均小于20。事实上，因为疫情影响，2023年超大型自治系统的规模已经小了许多，因此曲线的陡度才略小于图2。在这期间的20年间，图2所展现的才是常态。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/degree_distribution_cdf/result/degree_distribution_cdf_2000.png)
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/degree_distribution_cdf/result/degree_distribution_cdf_2023.png)
我们也计算了每年的平均节点度数，它从1998年的4.90,一路升至2022年的16.74,在2023年首次相较有所下降（16.34）。这一度数的提升主要为超大型自治系统膨胀的结果。


### 5.4 宏观网络演变分析
对于贸易性质的不透明协议而言，其演变规律最能够彰显暗藏的规律。在这一章中，将探索整个自治系统节点、边的增减规律。
### 5.4.1 节点量值
此处的节点（node）即自治系统。自治系统总数的逐年增减变化图见图4。图中AS即为“自治系统”的缩写。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_years/AS_2000_2023.png)
图中，最上方的橙色色块为增值，中间的黄色色块为减值，下方的绿色色块为净增值。每个色块的具体数值显示在中央，色块长度与数值大小成比例。
对于净增值，也即每年净新增自治系统的数量，排除极端年份后稳定在区间[1500,3900]内，而网络的节点总数自2002年以达到了万级，因此其数值波动相较于总量并不明显。这一观察与5.3.1中自治系统的线性增长曲线是相符的。
相对稳定的净增值也意味着增值和减值并不稳定。图中可以看出橙色和黄色色块均有逐年增长的趋势。而鉴于二者的插值较为平均，我们可以推论增减值的总体增长幅度是相似的。这表明自治系统的增减并非全然是市场兴衰的指标，在网络贸易兴隆的年间，增减幅度都会相应上升。事实上，运营商选择撤去一个自治系统除了打算丢弃相关业务外，也完全可能是出于架构设计而进行的合并。这样能够更好地解释自治系统增减值之间的正相关性。
2015年是图中唯一一个净增值为负的年份。由于图中增减值为1月的数据，且是相对前一年的变化值，所以2015年的数值实际上是由2014年后期的变化形成的。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_month/AS_2014.png)
图5为2014年各月份自治系统的增减值情况，绘制方法与图4一致。图中4,5,6月份数据产生了极大颠簸。4月减值是正常值的4倍左右，5月增值是正常值的4-5倍，6月减值是正常值的5-6倍。这样的数据波动有两种可能。一是事实情况下确实发生了自治系统的大规模删减重组，二是由于统计操作导致的数据波动。提出第二种可能性的根据在于，图中数值均为相对于前一个月的变化值。若某个月的数据在收集过程中遗漏丢失，而下个月恢复正常，那么图中的报复性反弹就可以解释（尤其考虑到数据原始形态为BGP路由）。但是图中的情况无法完全被数据收集漏差解释：若4月数据存在遗漏，5月数据收集正常，因此4、5月份间产生落差，那么6月的峰值只能再次用数据漏差解释。但在随后的7到12月份中，反弹并未出现，并且其数值大小持续偏小。从图4可以看到，网络每年的数值变化量（包括增减值和净增值）是逐年增大的。2013年的逐月自治系统增值平均值为515，即使早在2010年这一均值也达到了478。而2014年7到12月的增值数值在区间[291,348]间浮动，属于偏小的状态。如果继续看2015年的数据图，我们会发现在2015年年初，增值数据猛增，而在随后的月份，各项数值均恢复到正常水平。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_month/AS_2015.png)
鉴于上述分析，2014年4至6月的颠簸并不能被数据收集误差解释，而是事实情况。且结合2015年数据，我们发现对于自治系统数量，存在波动和弹性。一次异常峰值往往紧伴着一次异常的谷值，以将平均数值拉平。
那么，在颠簸的月份中究竟发生了什么？通过统计月份间节点重合度我们发现，4月删去的节点（1342个）中，有1120个在5月重新出现，而5月份增加的众多节点（1796个）中，有1555个在6月消失。6月删去的节点（1778个）中，有1466个在2015年2月重新出现。一个可能的猜想是，这是运营商的“维护”时段。可能出于架构升级或重组的目的，运营商将其旗下的自治系统暂时回收，待维护完后重新放出。至于为何全球的运营商均集中在2014年进行维护，我们不能肯定。也许与互联网协议变更有关联。
自治系统数量的增减似乎与时间并无显著关联。我们尝试探索了其与月份的联系，猜测也许在某些月份会有规律性浮动，或按照一年周期浮动，但并未观察到类似情况。可以说自治系统增减与时间的关联性并不强。
### 5.4.2 边量值
此处的边（egde）指自治系统间所签订的协议。若将自治系统关系网看作一张有向图，那么自治系统间签订的协议则构成节点间的边。本数据集中的协议包括提供商-顾客型和同行型。对于提供商-顾客型边，看作由提供商自治系统指向顾客自治系统的一条单向边。对于同行型边，视作作为同行双方的节点互相指向的两条单向边。所有边没有权重，或可看做权重均为一。
本实验中建模使用有向边，是出于研究贸易关系考虑。贸易双方节点处于不同的位置，这种差异使用无向边无法表示。而另一方面，在社群分析等涉及连通性的算法中，则需要淡化边的方向，此时我们把有向图转为无向图。有向边（提供商-顾客）的方向可以理解为服务流动的方向。
2001至2023年的协议签订总量相较前一年同期的变化图见于图6。图中"ASR"即为“自治系统协议”的缩写。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_years/ASR_2000_2023.png)
图中，最上方的橙色色块为增值，中间的黄色色块为减值，下方的绿色色块为净增值。每个色块的具体数值显示在中央，色块长度与数值大小成比例。
相较于5.4.1中节点的波动图图4,边也即协议量的增长趋势更为明显。与节点基本稳定的净增值不同，绿色色块代表的净增值有持续增加的趋势。在5.3.1中我们通过计算印证了自治系统协议的增长基本符合指数增长，也与这里的现象符合。
在节点数减小的2015年，边数仍然保持了增加，但增势稍有放缓。而在疫情影响的2021-2023三年，边数在20年来首次减少（2021与2023年净减）。疫情对自治系统协议量的影响远大于对自治系统量的影响。
按年为单位看，边数总体是稳定上涨的。但若以月为单位，我们发现边数的变化比节点变化频繁许多。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_month/AS_2018.png)
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_month/ASR_2018.png)
图7、8分别为2018年节点数的按月变化，和边数的按月变化图。其余年份与上述二图相差不大。通过对比我们可以看出：虽然节点数稳定增加，但边数依然频繁出现突增突减;且随着节点数的增多，边数的增量并未随之增加（图8橙色色块）。相较于节点，边的波动更为频繁，幅度也更大。这一观察与现实情况是相符的。启动和取缔一个自治系统所消耗的资源、精力要大于签订协议耗费的精力，运营商需要申请编号，配置环境，加入路由等。而自治系统间协议本身就是灵活的。运营商在不想维系原先的合约时可以重新选择或通过谈判得到满意的服务，与潜在的利润相比，更换的代价相对较小。运营商在面临结构调整的情况下，必然会优先考虑调整自治系统间的协议，而尽量避免自治系统级的更替。
### 5.4.3 量值增减比
上述关于节点和边的量值趋势图中，我们可以大致看出二者总量都在稳定上升。在这一节中，我们来看一下这20年间增长趋势的变化。
![alt text](/home/gudau/Documents/School/year4/graduatePaper/report/R/node_edge_fluc/result/across_years/ratio_2000_2023.png)
图9计算了2001至2023年每年节点（边）的增量与减量的比值。红色为节点（AS）的变化曲线，蓝色为边（ASR）的变化曲线。比值越大，增长趋势越大。当比值为1时，总量维持不变。
总体来说，两条曲线多年间均在缓慢下降。这说明随着互联网发展成熟，开发新地区，拓展新网络的势头渐渐殆尽。这一点在后面章节绘制的世界自治系统社群图中也可以看出。而代表边的蓝线多数都低于代表节点的红线，表明调整（取缔）协议的操作要远多于调整节点的操作（我们已经知道新增协议数要远高于新增节点数，因此比值的落差来自删减协议数）。在2021年后，协议增减比值首次破1,象征着节点间关系的调整成为运营商的新重心。
### 5.4.4 新增（减）边与点的关系
当一个自治系统被删去，其所有相关的协议也将一并消失。同样，当新增一个自治系统，它也需要通过其新减的协议关系被路由表所知晓。那么对于新增或新减的协议，它们与同期新增减的自治系统关联度如何？运营商是更倾向于与新增节点签订协议，而是选择原先节点？
为了计算这个问题，我们首先选取一个基准时间(pivot time)，记为P。随后我们选择一个在P之后的进行比对的时间，记为N。P时间所对应的自治系统集合，也即节点集合，记为Node_P。对应的自治系统协议集合，也即边集，记为Edge_P。同样，N时间对应的节点集记为Node_N,边集记为Edge_N。通过计算集合差，我们可以得到自时间P至N的新增节点集和新增边集，即
added_Node = Node_N - Node_P,added_Edge = Edge_N - Edge_P
接下来我们需要统计 added_Edge 中，有多大比例的端点(end point,即边所连接的节点)处于 added_Node 中。为此，我们分别统计两端点均在 added_Node 中(ASR with both ends in added AS)的边数N_both，及只有一端节点处于added_Node中(ASR with one end in added AS)的边数N_one, 并计算它与新增边集 added_Edge 长度的比值:
r_both = N_both / length(added_Edge)
r_one = N_one / length(added_Edge)
得到端点位于新增节点中的新加入边的比例r后，我们还需要计算随机状态下新边位于新加入点中的概率，也即计算基准值(pivot)。首先我们计算新加入点在总节点集中的比例 r_new_node:
r_new_node = length(added_Node) / length(Node_N)
若要构造一条随机新边，那么其一端节点落于新增节点的概率应等于r_new_node。另一端节点也在新增节点内的概率相同。因此，对于两端点均在 added_Node 中的基准值，即为pivot_for_both = r_new_node^2
而对于一端处在新增节点，另一端否的情况，可以类似推理算出为 
pivot_for_one = 2*(r_new_node)*(1-r_new_node)
以上四个公式即为判断新增边与新增点关联度的曲线函数。对于新减，计算方法与上完全相同，只是将新增集合替换为新减集合。
注意上述过程过有一个非平凡的影响量，即基准时间P的选取。由于公式计算的是累计值，因此基准值应尽量取早。本实验出于绘图清晰度考虑，选择了20年的观测区间，绘制了2002-2022和2000-2020的图，此处展示前者，但反映的规律一致。
图10是新增边位于新增节点中比例变化曲线。时间基准为2002年。
![alt text](report/R/node_edge_fluc_relation/result/add_2002_2022.png)
先看两端端点均在新增点中的情况，即红色的"ASR with both ends in added AS"，基准曲线为蓝色。基准值曲线在初始时值非常小(0.055)，但至2021年已到达0.788，实际上反映了新增点占总节点比例的提升。在2002年时，节点总量仅有32k,至2021年时已有566k。因此到后期，2002年的旧节点仅占5.6%左右。而在20年间，实际的两端端点均在新加点中的新边比例曲线始终大幅低于基准值。由于基准值是随机情况下的概率，因此这一差异表明新增边并不”愿意“将两端点均置于新增点中。那么，即使在新增边占绝大多数的2021年，有很大一部分新增边仍然在与原先那只占5.6%的老节点签订协议。
我们再看仅有一端节点位于新增点中的情况，即绿色的"ASR with one end in added AS"，基准曲线为紫色。这两条线更有戏剧性：在2007年前，实际值低于基准值，而在2007年后，实际值高于基准值，且将差值渐渐拉大。实际值低于基准曲线，意味着在2002后的最初几年，多数新增边并不符合”一边在新增点内“的模型（或是说符合这一模型的比例偏小）。结合红色曲线，我们知道在这几年新增边也同样不符合”两边均在新增点内“的模型。那么在2003至2006这几年，多数协议仍然在原先的旧节点间建立。而在2007年后，实际曲线逐渐高于基准值，说明符合这一模型的新边比例逐渐升高，近乎是基准值的2倍。这表明在后面几年中，新增节点与原有节点建立协议的倾向性是很高的。这也帮助解释了前述两端点均于新增点中边比例偏低的现象。
此外，图中在2021年，两条实际数值线产生了波动。这是由于2021年新增节点比例（r_new_node）小于前面年份导致。图中红线的基准计算公式为r_new_node^2，与r_new_node正向关，因此2021年突然降低;而绿线的基准计算公式为2*(r_new_node)*(1-r_new_node)，当r_new_node等于0.5时取到最大值，r_new_node大于0.5后单调递减。图中绿线的峰值显然已过，且2021年时新增节点所占比例已大于0.5,故r_new_node的突然降低使得绿线在2021年短暂升高。
上述分析说明两件事情：一，老节点的影响力大而深远。即便经过了20年，2002年的老节点只占5%的情况下，仍有许多新的协议倾向于和这部分节点签订。二，新加入节点从出现到发挥影响力，需要几年时间。从2003至2006这几年的情况来看，虽然新增节点所占比例不低，协议仍主要在原先节点间建立。事实上，参照5.3.3中的度数分布，新节点50%以上均为度小于3的边缘节点。这类节点可能会与中心的强连通团（mesh）建立关系，也可能维持边缘节点(tree node)的状态多年。这样来看，老节点持续的影响力也可以解释。

接着我们再来看新减的情况。图11绘制的是新减边与新减节点的关联曲线。时间基准也为2002年。
![alt text](report/R/node_edge_fluc_relation/result/del_2002_2022.png)
与新增图非常不同的是，新减节点的实际比例曲线与基准曲线相差不大（最大差值为0.64），几乎相合。
虽然相差不大，但两端均处于新减节点的边比例，即红色的"ASR with both ends in deleted AS"，始终低于蓝色的基准线，且在2013年后有差距拉大的趋势。这说明删减的协议，随着时间推移，越来越多的出自原有节点。仅一端处于新减节点的边比例，即绿色的"ASR with one end in deleted AS"，先略高于紫色的基准值（2003-2013），后低于基准值，且差距逐渐扩大。这说明在2003年后的开始几年，较多的删减协议为留存节点和新减节点间签订。而至后期，删减协议则倾向于来自保留下来的老节点间（2013年后，红绿两者模式的实际比例均低于基准，因此占更多比重的边只能是剩下那种）。
通过上述分析可知，总得来说，新减边与新减节点的关联性并不强，但后期删除的协议更倾向于来自留存的节点。

### 5.4.5 增减节点（边）的连接性
在这一节中，我们探究新增减的自治系统的连接属性。也即它们在网络中的影响力。
对于节点（自治系统），我们计算了多项指标，包括effective size,degree等。得到的数据中，这些指标的代表性相差不大。为了简化表示，我们使用自治系统的协议数，也即边数（degree）来代表其连通性。
下表表1为2002年，2012年，2022年同期（一月）新增节点的度数分布。在三个年份中，均有超过半数的新增节点度数小于等于2,说明新增节点的主要来源是全新开发的自治系统此外，三年中新增的较大度数节点度数持续增大，2022年最大节点度数为3743,在当年所有节点中的度数排名为29。表明各年均稳定存在一些对于区间节点的维护。
表2为2002年，2012年，2022年同期（一月）新减节点的度数分布。相较于新增节点，新减的高度数节点比例相对更小。2022年新减的最高度数节点为1132。说明运营商在进行节点删除操作时，对高度数节点更加谨慎。
对于边（自治系统协议），可用于判定其影响力的指标包括边上的介数中心性（betweeness_centrality），可用于检查结构洞的效应值（effective size）等。我们本想结合结构洞理论，猜测新增边可能会与潜在的结构洞相联系（structural hole spanner）。
结构洞（Structural Hole）指的是网络中连接两个或多个不同社群的节点或关键人物。在社交网络中，结构洞是指一个人同时具备着两个或多个不同社交群体的联系，是社交网络中的重要节点。这些节点连接着不同社群，有着更广泛的信息流动和资源获取的机会。在组织或企业内部，拥有结构洞的人员通常可以获得更多的资源和信息，并且更容易在组织层级中升职和获得更多的影响力。因此，结构洞的概念在社会网络分析和组织行为学等领域有着重要的意义。在图中，结构洞可以通过网络分析和社区检测等方法进行识别和分析，有助于了解网络中节点之间的联系和影响力，从而更好地理解网络的结构和功能。
理论上说，对于一个以获取流量为目的的网络，结构洞，根据其定义，正是可以帮助运营商赚取更多利益的枢纽位置。但经过计算新边的结构洞指标，我们并未发现新边成为structural hole spanner的倾向。可能的解释有很许多。一是选取的指标不适合当前图。由于结构洞存在多种算法，比较精密的算法运算成本较高，因此本实验中转而选取了一种替代指标，即通过节点上的效应值和约束(constraint)来计算结构洞。但根据上述替代指标计算的结构洞，经过比对与直接根据度数大小排名得到的节点相似度极高。这说明替代算法并不十分理想，或者当前的自治系统网络连通性已非常高，因而结构洞的存在几乎等同于高度数节点。第二种解释是，运营商新建协议的重心不在于占取枢纽。我们从表1已经看到，绝大多数新增点度数极小，位于网络边缘，属于树形结构，仅服务小区域用户。对于其管理的其他节点，碍于运营的成本，商业谈判约束，行情和周遭网络结构频繁变化等等，都决定了运营商会选择尽量优化已有节点，即使知晓一个可能结构洞的存在，也未必会冒险改变现有框架去实现它。
虽然结构洞理论的探索并不成功，但结构洞算法所代表的，用网络结构中关键位置去定义边、点影响力的思路，仍是可取的。因此我们换了一种指标，使用自治系统协议（边）两端所属社群（community）的分布情况去衡量边的影响力。
社群检测(community detection)是指在复杂网络中识别具有内在紧密联系的节点群体的过程。其算法方法包括模块度优化、谱聚类、标签传播等。通过对网络进行社区检测，可以帮助我们了解网络结构的特征和模式，揭示网络中节点之间的相互作用关系，发现潜在的子群体和社区结构，并为预测节点行为和网络演化提供基础。在本文中，子群体由自治系统构成。自治系统子社群的划分，标志着自治系统网络的聚合结构。这些自治系统子社群通常代表着在自治系统网络中，拥有类似连接模式、服务类型和流量传输模式等特征的自治系统的集合。
我们使用networkx中提供的community detection louvain方法，对2001至2023年1月的自治系统数据均进行了社群检测。对于每份数据，运行该算法后得到一组自治系统编号集，每个集合即为一个社群。社群的大小分布不均，断层较大。以2020年的社群结果为例，共有137个社群，最小的社群含2个自治系统，最大的含18011个自治系统。137个社群中比例最高的社群为大小为2的社群，有52个。由于除大小小于20的小规模社群外，其余社群的大小都是独特的(unique)，因此我们通过社群大小给所有每个时间点网络中的社群排名。
图12、13分别为2003，2023年新增（减）边两端节点所属社群排名的CDF曲线。"Added"开头曲线为新增，"Deleted"开头曲线为新减，"Both"表示两端点均符合，"One"表示仅有一端点符合。如"Added Both"曲线上点(x, y)代表“共有比例为y的新增边两端节点所属社群的排名均不大于x”。另外，在同一个社群内的边（即两端点属于同一社群）所占比例也在图中标出。自2000-2023，这一比例在区间[0.65,0.8]间浮动，没有明显的时间规律。
![alt text](report/R/edge_fluc_community_distribution/result/fluc_ASR_community_rank_cdf_20030101.png)
![alt text](report/R/edge_fluc_community_distribution/result/fluc_ASR_community_rank_cdf_20230101.png)
由于两端点的约束条件比一端点严格，因此图中"Both"标注的橙、蓝两条线分别位于标注"One"的曲线下方。从图12可以看到，有至少50%的新增（减）边来自排名前三的社群，以及有至少90%的新增（减）边来自排名前二十的社群。图13中，向排名靠前社群的聚集效应更加明显：90%的新增（减）边属于排名前八的社群。
在两图中，四条曲线的相对位置是近乎一致的。在社群排名5往前，新增边对应的曲线收敛速度略快于新减边。而在社群排名5之前，新减边的曲线持续高于新增边。这一现象表明新增边相比新减边略更集中于排名前4的大社群，而在排名5往后，新减边相对更集中于排名靠前的大社群。


### 5.5 自治系统层级的实例分析
在前面章节中介绍了自治系统边与节点变化的宏观规律。在这一章中，我们仍然聚焦自治系统的波动，但将从更底层的案例出发，选择部分自治系统，观察其规律。由于这一章为案例分析，将从绘制的图表、数据表中提取规律，但结论主要来自主观推理，因此受主观因素影响。
### 5.5.1 各层级自治系统的度数变化
由于运营商的政策更迭，自治系统往往会经历拆分、合并、重组、重定协议等操作。在这期间，经历维护的自治系统将表现出波动。其中最明显的波动特征即为协议数变化，即该自治系统（节点）的度数变化。在观察具体自治系统度数逐年变化规律的时候，我们发现当某些自治系统度数经过多年积累到达一个足够大的值时，这个自治系统的度数会在很短的时间内急剧下跌，甚至消失。这样的自治系统量级非常大，突然消失而不产生任何后果看起来不符合业务逻辑。我们的猜想是，这个消失的自治系统由于种种原因被运营商拆分成了多个替补自治系统，这些替补继承了原先大自治系统的大部分业务协议。
为了证实这个猜测，我们进行了如下探索：对于一个突然消失的大自治系统AS1，在消失同年，计算其邻居（直接相邻节点）的相邻节点与AS1原先邻居的交集大小及变化，并对这些邻居的数据和背景信息进行观察。我们确实找到了一些类似于拆分替补的案例。如编号25462这个节点。它在2008年后消失，消失时仍有646个邻居（也即度数）。而在2009年，有同一个运营商"RETN-UA-AS"旗下的另一个自治系统，编号9002突然出现（20080101数据中不存在），且在20090101的数据中，9002节点与570个25462原先的邻居相连，占原先协议数的88%。但这类明显的例子并不多，大多数情况下我们确实能够找到新旧节点共享邻居数超过60%的新节点，但我们没有其他诸如”同属一个运营商“这样强有力的证据说明这两个节点的重合度不是巧合。因此，想直接证明这一点是比较困难的。
由于直接分析单个节点的拆分和合并规律未能成功，我们退而探索是否能从更长的时间跨度和更多的节点数上归纳出规律。
图14、15、16、17分别为20140101数据中按度数排名前10自治系统，20100101数据中排名200左右的10个自治系统，20100101数据中排名1000左右的10个自治系统,及20200101数据中排名5000左右的10个自治系统在2000至2023年区间内的逐年度数情况。此处节点已进行筛选，保证节点在中途并未出现更换更名。
选择不同时段的自治系统观测，一是为了随机性，二是也可以观察时段特征。
![alt text](report/R/AS_sample_10_trend/results/AS_2014_top_10_degree_rank.png)
![alt text](report/R/AS_sample_10_trend/results/AS_2010_mid_10_degree_rank.png)
![alt text](report/R/AS_sample_10_trend/results/AS_2010_midtail_10_degree_rank.png)
![alt text](report/R/AS_sample_10_trend/results/AS_2020_tail_10_degree_rank.png)
上述图中，排名进入前十的节点颜色标红。后三张图（图15,16,17）中节点度数大于300会将度数标出。
图14中，2010年度数前十的自治系统在两年后仅剩6个维持在前十，而在2023年仅剩2个。2010-2012年是图中3条曲线仅有的进入前十的时段。对于其余大部分曲线，也在某些年段表现出了”上涨-下跌“的模式。在这23年区间内，共有60个自治系统进入过排名前十。但观测其余年份前十节点的度数趋势图会发现，除了极少几条曲线保持涨势到最后，其余自治系统仅在自己进入前十的2-3年内排名高，随后度数下跌，并不再出现前面的涨势。对于保持住涨势的节点，亦或其出现较晚，亦或其的增长幅度从未过高，但是几乎稳定（如图14中黄色、粉红两条线）。在这里可以得到一个模糊的结论，即节点度数上涨到一定值后，一旦开始回落，后续就几乎不会再出现同样的涨势。
![alt text](report/R/AS_sample_10_trend/results/AS_2023_top_10_degree_rank.png)
图18是2023年1月排名前十节点的度数趋势图。注意，此处显示出了所有自治系统编号，并未筛选曾在某年间不存在的节点。可见这些自治系统在2000-2023区间内均为上升趋势。可以预测，在后续1-2年里这其中将有多个自治系统度数骤减。
其余图表中的自治系统随机选自对应数据文件处于该度数排名区间的自治系统中。由于自治系统度数分布的长尾效应，这部分节点的体量很大，因而随机性更强。图15、16、17中均可看出”X“型分布：在聚合的时间点前后，各条曲线的走势均发散，表明曲线度数随年波动。而在聚合时间后的发散程度要高于聚合时间前（体现为聚合时间后曲线间的方差更大），说明随着年限增大，网络的活跃度更高，熵增加。也可能是由于随着这些采样自治系统前些年份的资源积累，后期的影响力、活力更大。后一种解释的支撑在于，在这三张图中，图15（其中节点排名处于中位，1000名左右）的自治系统曲线在聚合时间点后的活跃度要显著大于其他图。这张图中的自治系统相比于其他图低度数的自治系统拥有更多资源（相邻节点，积累的经验等），因此后期的活度可能也与此有关。

### 5.5.2 


### 5.6 以国家为单位的聚合分析
### 5.7 新冠疫情的影响分析及启示
## 六 结论
## 七 参考

    